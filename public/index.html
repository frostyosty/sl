<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="robots" content="index, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Alegreya:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
  
<!--   swapped fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"> <!-- Alternative to Raleway -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet"> <!-- Alternative to Old Standard TT -->
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet"> <!-- Alternative to Parisienne -->
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet"> <!-- Alternative to Dancing Script -->
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet"> <!-- Alternative to Open Sans -->
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet"> <!-- Alternative to Montserrat --
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet"> <!-- Alternative to Alegreya -->

  
  
  
  <!-- newspaper title -->
  <link href="https://fonts.googleapis.com/css2?family=Fredericka+the+Great&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/styles.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>
  <title>END SLUTTERY</title>
</head>

<body>



    <div class="header-container">

         
        <!-- option 1 -->
                    <!-- <div class="header-background-image"></div>
                    <canvas id="starfield"></canvas>
                    <div class="header-foreground-image"></div>
                    <div class="search-tabs-container"> -->
        
        
       
        
        
        <!-- searchbar optional -->
                      <!-- <div class="search-container">
        
                          <input type="text" id="searchBar" placeholder="Search...">
                          <button onclick="searchText()">Search</button>
                      </div> -->
        
        
                      <nav>
                     <!--   <div class="hamburger-menu" onclick="toggleMenu()">
                            <span class="bar first"></span>
                            <span class="bar second"></span>
                            <span class="bar third"></span>
                            <span class="bar fourth"></span>
                            <span class="bar fifth"></span>
                            <span class="bar sixth"></span>
                            <span class="bar seventh"></span>
                            <span class="bar eighth"></span>
                            <span class="bar ninth"></span>
                            <span class="bar tenth"></span>
                            <span class="bar eleventh"></span>
                            <span class="bar twelfth"></span>
                            <span class="bar thirteenth"></span>
                            <span class="bar fourteenth"></span>
                            <span class="bar fifthteenth"></span>
                            <span class="bar sixteenth"></span>
                            <span class="bar seventeenth"></span>
                            <span class="bar eighteenth"></span>
                            <span class="bar nineteenth"></span>
                            <span class="bar twentieth"></span>
                            <span class="bar twentyfirst"></span>
                            <span class="bar twentysecond"></span>
                        </div>-->
                        <div class="tabs">
                            <button class="tablinks active" onclick="openTab(event, 'add')">Add</button>
                            <button class="tablinks" onclick="openTab(event, 'love test')">Love Test</button>
                            <button class="tablinks" onclick="openTab(event, 'find')">Find</button>
                            <button class="tablinks" onclick="openTab(event, 'other')">Other</button>
                        </div>
                      </nav>
                  </div>
        
                

        


            


      <div class="wrapper">
        <div class="gutters left-gutter"></div>
  <!-- Container for tab contents -->

  
<div id="tabContentsContainer">
  

    


  
<div id="add" class="tabcontent">

  <!--       TABLE SUBMISSION SECTION  -->
                  
                  <!-- submit section -->
                  <div id="entry-submit-section" class="block">
                    <div class="header fancyHeader">Add a Slut</div>
                    <form id="entry-form">
                      <div class="entries-submit-row">
                          <!-- Name Entry -->
                          <label for="name">Name:</label>
                          <input type="text" id="name" placeholder="Enter Name" required>
                      </div>
                  
                      <div class="entries-submit-row">
                          <!-- Description Entry -->
                          <label for="description">Description:</label>
                          <input type="text" id="description" placeholder="Enter Description" required>
                      </div>
                  
                      <div class="entries-submit-row">
                          <!-- Approximate Date -->
                          <label for="approx-date">Approximate Date:</label>
                          <input type="date" id="approx-date" required>
                          <button type="button" onclick="setToday()">Today</button>
                          <button type="button" onclick="setYesterday()">Yesterday</button>
                      </div>
                  
                      <div class="entries-submit-row">
                          <!-- Approximate Age -->
                          <label>Approximate Age:</label>
                          <div>
                              <input type="radio" id="age-18" name="approx-age" value="18">
                              <label for="age-18">18</label>
                              <input type="radio" id="age-21" name="approx-age" value="21" checked>
                              <label for="age-21">21</label>
                              <input type="radio" id="age-25" name="approx-age" value="25">
                              <label for="age-25">25</label>
                          </div>
                      </div>
                  
                      <div class="entries-submit-row">
                          <!-- Ethnicity -->
                          <label for="ethnicity">Ethnicity:</label>
                          <input type="text" id="ethnicity" placeholder="Enter Ethnicity" required>
                      </div>
                  
                      <div class="entries-submit-row">
                          <!-- Submit Button -->
                          <button type="submit" class="button-style-3-gold button-general-formatting">Submit Entry</button>
                      </div>
                  </form>
                    
                  <div id="entry-message-container"></div>
                
                </div>
  <!--       closing add section div below -->
              </div>
  
              


              
    

<!--       MAIN TABLE -->
<!--       VARIABLES NEEDED        name description  approx_date approx_age ethnicity created_at and ip -->





  <div id="love test" class="tabcontent">

          
        <div id="love-test-container">
          <div id="love-test-table-wrapper">
              <table id="love-test-table">
                  <thead>
                      <tr><th class="fancyHeader">Love Test Table</th></tr>
                  </thead>
                  <tbody>
                      <tr><td>Click on the rows to make your formula</td></tr>
                  </tbody>
              </table>
          </div>
          <div id="love-meter-container">
              <div id="love-meter">
                  <div id="love-meter-bar">
                    <div id="skullAndBones"></div>
                </div>
              </div>
              <div id="love-score">Score: 0</div>
          </div>
      </div>
  
        

    </div>



    <div id="find" class="tabcontent">

                  
                      <div id="entry-table-container">
                        <div class="header fancyHeader" id="fancyHeaderEntries">Known Sluts</div>
                        <table id="entry-table" class="block">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Allegation</th>
                                    <th>Happened on</th>
                                    <th>Age</th>                            
                                    <th></th>
                                    <th></th>
                                    <th>Filed</th>
                                </tr>
                            </thead>
                            <tbody id="entry-table-body">
                                <!-- table rows injected here -->
                            </tbody>
                        </table>
                    
                        
      
      <!--   closing entry table div -->
                      </div>
            




      <!-- have not used side by side container this iteration but could use later to put side by side -->
      <!--             <div id="entry-side-by-side-container"> -->
        <div class="header fancyHeader" id="fancyHeaderEntries">Check If Slut</div>
        <!-- filters Section -->
        <div id="entry-filters" class="block">

          <div id="entry-filters-wrapper">
          <!-- <div class="header fancyHeader">Filter</div> --muted as not really needed -->
            <form id="entry-filters-form">

                <div class="entries-filters-row">
<!--                                   <label>Time Range:</label> -->
                    <div>
                      <input type="radio" id="filter-any" name="time-range" value="all" checked>
                      <label for="filter-any">Any</label>
                      <input type="radio" id="filter-this-week" name="time-range" value="week">
                      <label for="filter-this-week">This Week</label>
                      <input type="radio" id="filter-this-month" name="time-range" value="month">
                      <label for="filter-this-month">Month</label>
                      <input type="radio" id="filter-this-year" name="time-range" value="year">
                      <label for="filter-this-year">Year</label>
                    </div>
                 </div>
<!--                               <div class="entries-filters-row"> -->
                </div>
                <div class="entries-filters-row">
                    <!-- <label for="filter-item">Filter:</label> -->
                    <input list="item-list" id="filter-item" placeholder="Type or select an item to filter for">
                    <datalist id="item-list"></datalist>
                </div>
                <!-- APPLY FILTER BUTTON IF NEEDED IN THE FUTURE -->
                <!-- <button type="submit" id="apply-filter-submit" class="button-style-3-purple-v2 button-general-formatting">Apply Filters</button> -->
            </form>

          </div>
          <!-- below is closing div for side by side -->
<!--                       </div> -->






      <!-- closing find container div -->
                  </div>





  
    <div id="other" class="tabcontent">
    </div>
  

<div id="csf-comment-section">
  <div id="csf-comment-section-form">
    <textarea id="csf-comment-section-text" placeholder="Write a comment..." required></textarea>
    <button id="csf-comment-section-submit">Submit Comment</button>
  </div>
  <div id="csf-comment-section-comments"></div>
</div>







    </div><!-- closing tab contents container-->
  <div class="gutters right-gutter"></div>
</div><!-- closing wrapper container-->

<script src="index.js"></script>















<script>



// Load comments when the document is ready
document.addEventListener('DOMContentLoaded', () => {
  loadComments();

  // set up MutationObserver to watch for new comments
  const commentsContainer = document.getElementById('csf-comment-section-comments');
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      mutation.addedNodes.forEach((node) => {
        if (node.nodeType === Node.ELEMENT_NODE && node.parentNode) {
          // select node here or handle other logic

          // any extra logic needed to handle newly added nodes
        }
      });
    });
  });

  observer.observe(commentsContainer, { childList: true });
});

// Submit a new comment
document.getElementById('csf-comment-section-submit').addEventListener('click', async () => {
  const commentText = document.getElementById('csf-comment-section-text').value.trim();
  if (!commentText) return alert('Comment cannot be empty.');

  const userIp = await getUserIp();
  const newComment = {
    comment_text: commentText,
    user_ip: userIp,
    user_hex_color: '#000000', // default for optimistic render
    depth: 0,
    likes: 0,
    dislikes: 0
  };

  renderComment(newComment, true); // Render comment optimistically

  // Submit to the server
  const response = await fetch('/api/csf-comment-section', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ commentText, userIp })
  });

  if (response.ok) {
    loadComments(); // Reload all comments if successfully submitted
  } else {
    const result = await response.json();
    alert(result.message); // Rate limit or error messages
  }
});
// Load and render the five most recent comments
async function loadComments() {
  const res = await fetch('/api/csf-comment-section'); // Only fetches top-level comments
  const comments = await res.json();
  const commentsContainer = document.getElementById('csf-comment-section-comments');
  commentsContainer.innerHTML = ''; // Clear previous comments

  comments.forEach(comment => {
    // Check if user_ip is present and log for debugging
    console.log("Processing comment:", comment);

    if (comment.user_ip) {
      // Generate guest name from user IP
      comment.user_name = generateGuestName(comment.user_ip);
      console.log("Generated name:", comment.user_name); // Log generated name
    } else {
      // Fallback if user_ip is missing
      comment.user_name = "Guest";
      console.warn("No user IP found, using default name:", comment.user_name);
    }

    renderComment(comment);
  });
}

// Render a single comment
function renderComment(comment, isOptimistic = false) {
  const commentElem = document.createElement('div');
  commentElem.className = 'csf-comment';
  commentElem.id = `comment-${isOptimistic ? 'temp' : comment.id}`;
  commentElem.innerHTML = `
    <div class="csf-comment-header">
      <div class="csf-comment-icon" style="background-color: ${comment.user_hex_color}"></div>
      <span>${comment.user_name}</span>
    </div>
    <div class="csf-comment-body">${comment.comment_text}</div>
    <div class="csf-comment-footer">
      <button onclick="likeComment(${comment.id})">👍 ${comment.likes}</button>
      <button onclick="dislikeComment(${comment.id})">👎 ${comment.dislikes}</button>
    </div>
  `;
  document.getElementById('csf-comment-section-comments').appendChild(commentElem);
}


// Like a comment
async function likeComment(id) {
  await fetch('/api/csf-comment-section', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, action: 'like' })
  });
  loadComments();
}

// Dislike a comment
async function dislikeComment(id) {
  await fetch('/api/csf-comment-section', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, action: 'dislike' })
  });
  loadComments();
}

// Fetch user's IP
async function getUserIp() {
  const response = await fetch('/api/get-ip');
  const { ip } = await response.json();
  return ip;
}

// refresh every 30 seconds
document.addEventListener('DOMContentLoaded', () => {
  loadComments(); // Initial load
  setInterval(loadComments, 30000); // Reload every 15 seconds
});


// name generator


// Function to convert IP to a unique, pronounceable guest name
function generateGuestName(ip) {
  // Split the IP into segments and process each number
  const segments = ip.split('.').map(Number);
  let processed = segments.map(num => Math.floor(num / 3)).reverse();

  // Character sets for consonants and vowels
  const consonants = 'bcdfghjklmnpqrstvwxyz';
  const vowels = 'aeiou';

  // Build the name by alternating consonants and vowels
  let name = '';
  processed.forEach((num, index) => {
    if (name.length >= 9) return; // Stop if the name reaches max length
    if (index % 2 === 0) {
      name += consonants[num % consonants.length];
    } else {
      name += vowels[num % vowels.length];
    }
  });

  return `Guest name: ${name}`;
}








// log deployment count personal for working within deployment-limiting environs
//today's date in UTC for timezone consistency
function getUTCDate() {
    const now = new Date();
    return new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));
}
function logDeploymentCount() {
    try {
        let deploymentCount = localStorage.getItem('deploymentCount');
        let storedDate = localStorage.getItem('deploymentDate');
        let currentDate = getUTCDate();

        if (!storedDate || new Date(storedDate) < currentDate) {
            deploymentCount = 0;
            localStorage.setItem('deploymentDate', currentDate.toISOString());
        }

        deploymentCount++;
        localStorage.setItem('deploymentCount', deploymentCount);

        console.log(`Iterations deployed today: ${deploymentCount}`);
    } catch (error) {
        console.error('Error occurred while logging deployment count:', error);
    }
}
logDeploymentCount();






































































  //tabs
 document.addEventListener('DOMContentLoaded', function() {
  //open the first tab on page load
  document.getElementsByClassName('tablinks')[0].click();
});
function openTab(evt, tabName) {
  var container = document.getElementById('tabContentsContainer');
  var clickedTabContent = document.getElementById(tabName);
  //clicked tab content to the top of the container
  container.insertBefore(clickedTabContent, container.firstChild);
  var tablinks = document.querySelectorAll('.tablinks');
  tablinks.forEach(function(tablink) {
    tablink.classList.remove('active');
  });
  evt.currentTarget.classList.add('active');
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}


//hamburger
function toggleMenu() {
  var menu = document.querySelector('.tabs');
  var hamburger = document.querySelector('.hamburger-menu');
  hamburger.classList.toggle('open');
  if (hamburger.classList.contains('open')) {
    menu.style.display = 'flex';
    document.addEventListener('click', closeMenuOnClickOutside);
  } else {
    menu.style.display = 'none';
    document.removeEventListener('click', closeMenuOnClickOutside);
  }
}
function closeMenuOnClickOutside(event) {
  var menu = document.querySelector('.tabs');
  var hamburger = document.querySelector('.hamburger-menu');
  if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
    menu.style.display = 'none';
    hamburger.classList.remove('open');
    document.removeEventListener('click', closeMenuOnClickOutside);
  }
}
























//scrolling gutters
console.log("Script loaded correctly");

window.addEventListener('scroll', function() {
    var scrollPosition = window.pageYOffset;
  
    var parallaxElements = document.querySelectorAll('.parallax');
    
    parallaxElements.forEach(function(el) {
        var speed = el.getAttribute('data-speed') || 0.5;
        var offset = scrollPosition * speed;
        
        // the offset
        console.log(`Offset applied to element with speed ${speed}: ${offset}`);
        
        el.style.transform = `translateY(${offset}px)`;
    });
});

</script>




  <!-- <footer>
 
    <p>No rights reserved &copy;</p>
  </footer> -->

</body>
